name: 'CI Script'
description: 'CI Script'
inputs:
  terraform_version:
    description: 'Who to greet'
    required: false
    default: '0.13.5'
  cli_config_credentials_token:
    description: 'The API token for a Terraform Cloud/Enterprise instance to place within the credentials block of the Terraform CLI configuration file.'
    required: false

# outputs:
runs:
  using: "composite"
  steps:
    - id: tf_install
      run: |
        export RUNNER_TEMP=/tmp \
        export terraform_version=${{inputs.terraform_version}} \
        export cli_config_credentials_token=${{inputs.cli_config_credentials_token}} \
        git clone https://github.com/hashicorp/setup-terraform \
      shell: bash
    - run: node setup-terraform/dist/index.js
      shell: bash
    - id: tf_login
      run: |
        echo 'credentials "app.terraform.io" {
          token = "${{inputs.cli_config_credentials_token}}"
        }' >> ~/.terraformrc
      shell: bash
    - id: tf_init
      run: terraform Init
      shell: bash
    - id: tf_plan
      run: terraform plan -no-color
      shell: bash

    # - id: tf_init
    #   run: docker run -i -v $PWD/terraform:/terraform -v $PWD:/.terraform -v ~/.terraformrc:/root/.terraformrc hashicorp/terraform:${{ inputs.terraform_version }} init /terraform
    #   shell: bash
    # - id: tf_plan
    #   run: docker run -i -v $PWD/terraform:/terraform -v $PWD:/.terraform -v ~/.terraformrc:/root/.terraformrc hashicorp/terraform:${{ inputs.terraform_version }} plan -no-color /terraform
    #   shell: bash